!function(){"use strict";function e(e){return e.split(/[/?#]/)}function t(e,t){var n=t.replace(/\?/g,"\\?").replace(/\*/g,"([^/?#]+?)").replace(/\.\./,".*"),o=new RegExp("^"+n+"$"),i=e.match(o);if(i)return i.slice(1)}function n(e,t){var n;return function(){clearTimeout(n),n=setTimeout(e,t)}}function o(e){m=n(u,1),E[M](A,m),E[M](S,m),k[M](O,c),e&&u(!0)}function i(){this.$=[],y(this),j.on("stop",this.s.bind(this)),j.on("emit",this.e.bind(this))}function a(e){return e.replace(/^\/|\/$/,"")}function r(e){return"string"==typeof e}function s(e){return(e||I.href).replace(x,"")}function l(e){return"#"===g[0]?(e||I.href||"").split(g)[1]||"":(I?s(e):e||"").replace(g,"")}function u(e){var t=0===Y;if(!(z<=Y)&&(Y++,X.push(function(){var t=l();(e||t!==w)&&(j[T]("emit",t),w=t)}),t)){for(var n;n=X.shift();)n();Y=0}}function c(e){if(!(1!==e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){for(var t=e.target;t&&"A"!==t.nodeName;)t=t.parentNode;!t||"A"!==t.nodeName||t[C]("download")||!t[C]("href")||t.target&&"_self"!==t.target||-1===t.href.indexOf(I.href.match(x)[0])||t.href!==I.href&&(t.href.split("#")[0]===I.href.split("#")[0]||"#"!==g[0]&&0!==s(t.href).indexOf(g)||"#"===g[0]&&t.href.split(g)[0]!==I.href.split(g)[0]||!d(l(t.href),t.title||k.title))||e.preventDefault()}}function d(e,t,n){return L?(e=g+a(e),t=t||k.title,n?L.replaceState(null,t,e):L.pushState(null,t,e),k.title=t,H=!1,u(),H):j[T]("emit",l(e))}function f(){var e=$("body").outerWidth(!0),t=$("body").outerHeight(!0);d3.select("svg.background").attr("width",e).attr("height",t).select("g").attr("transform","translate("+e/2+","+(t-150)+")")}function h(e){var t=$(e.target);$.publish("gallery.mouseenter",t),t.one("mouseleave",function(e){$.publish("gallery.mouseleave")})}function p(e){return new Promise(function(t,n){window.setTimeout(t,e)})}var m,g,w,v,b,y=function(e){e=e||{};var t={},n=Array.prototype.slice;return Object.defineProperties(e,{on:{value:function(n,o){return"function"==typeof o&&(t[n]=t[n]||[]).push(o),e},enumerable:!1,writable:!1,configurable:!1},off:{value:function(n,o){if("*"!=n||o)if(o)for(var i,a=t[n],r=0;i=a&&a[r];++r)i==o&&a.splice(r--,1);else delete t[n];else t={};return e},enumerable:!1,writable:!1,configurable:!1},one:{value:function(t,n){function o(){e.off(t,o),n.apply(e,arguments)}return e.on(t,o)},enumerable:!1,writable:!1,configurable:!1},trigger:{value:function(o){var i,a,r,s=arguments,l=arguments.length-1,u=new Array(l);for(r=0;r<l;r++)u[r]=s[r+1];for(i=n.call(t[o]||[],0),r=0;a=i[r];++r)a.apply(e,u);return t["*"]&&"*"!=o&&e.trigger.apply(e,["*",o].concat(u)),e},enumerable:!1,writable:!1,configurable:!1}}),e},x=/^.+?\/\/+[^/]+/,M="addEventListener",C="hasAttribute",A="popstate",S="hashchange",T="trigger",z=3,E="undefined"!=typeof window&&window,k="undefined"!=typeof document&&document,L=E&&history,I=E&&(L.location||E.location),D=i.prototype,O=k&&k.ontouchstart?"touchstart":"click",j=y(),P=!1,H=!1,X=[],Y=0;D.m=function(e,t,n){!r(e)||t&&!r(t)?t?this.r(e,t):this.r("@",e):d(e,t,n||!1)},D.s=function(){this.off("*"),this.$=[]},D.e=function(e){this.$.concat("@").some(function(t){var n=("@"===t?v:b)(a(e),a(t));if(void 0!==n)return this[T].apply(null,[t].concat(n)),H=!0},this)},D.r=function(e,t){"@"!==e&&(e="/"+a(e),this.$.push(e)),this.on(e,t)};var B=new i,R=B.m.bind(B);R.create=function(){var e=new i,t=e.m.bind(e);return t.stop=e.s.bind(e),t},R.base=function(e){g=e||"#",w=l()},R.exec=function(){u(!0)},R.parser=function(n,o){n||o||(v=e,b=t),n&&(v=n),o&&(b=o)},R.query=function(){var e={};return(I.href||w).replace(/[?&](.+?)=([^&]*)/g,function(t,n,o){e[n]=o}),e},R.stop=function(){P&&(E&&(E.removeEventListener(A,m),E.removeEventListener(S,m),k.removeEventListener(O,c)),j[T]("stop"),P=!1)},R.start=function(e){P||(E&&("interactive"===document.readyState||"complete"===document.readyState?o(e):document.onreadystatechange=function(){"interactive"===document.readyState&&setTimeout(function(){o(e)},1)}),P=!0)},R.base(),R.parser();var N,Q,q,K,W=d3.arc().innerRadius(5).outerRadius(2e3),F={init:function(e){e=e||40,(N=d3.selectAll(".wrapper").append("svg").classed("background",!0).append("g").append("g").classed("rotate stop",!0)).selectAll("path").data(new Array(e)).enter().append("path").attr("d",function(t,n,o){var i=2*Math.PI/e;return W({startAngle:n*i,endAngle:n*i+i/2})}),f()},resize:f,rotate:Q=function(){var e;return{start:function(t){N.classed("stop",!1),t&&(window.clearTimeout(e),e=window.setTimeout(Q.stop,1e3*t))},stop:function(){N.classed("stop",!0),window.clearTimeout(e)},toggle:function(){N.classed("stop",!N.classed("stop"))}}}()},Z={init:function(e,t,n){q=$("<div id='balloon'></div>").appendTo(t).attr("class","animated fast").css({right:"0px",bottom:"70.5px",width:"157.5px",height:"133px",backgroundImage:"url("+n+")"}).hide()},show:function(e){window.clearTimeout(K),q.removeClass("bounceOut").html(e).show().addClass("bounceIn")},hide:function(){K=window.setTimeout(function(){q.removeClass("bounceIn").addClass("bounceOut")},500)}};!function(e){var t=e({});e.subscribe=function(){t.on.apply(t,arguments)},e.unsubscribe=function(){t.off.apply(t,arguments)},e.publish=function(){t.trigger.apply(t,arguments)}}(jQuery);var G,J={display:function(e){return new Promise(function(t,n){_(e).orderBy("order").reverse().forEach(function(e,t,n){d3.select(".shapescontainer").datum(e).append("path").attr("d",e.path).attr("data-name",e.name).attr("data-id",e.id).attr("data-code",e.code).attr("data-textid",e.textId).style("display","none")}),_(e).orderBy("order").forEach(function(e,n,o){var i=e.anim||"bounceIn";window.setTimeout(function(){$(e.img).attr("data-id",e.id).css({zIndex:e.z,width:e.w*scale+"px",height:"auto",left:e.x*scale+"px",bottom:e.y*scale+"px"}).addClass("animated").addClass(i).appendTo(".peoplecontainer").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$("path[data-id='"+e.id+"']").show()}),n===o.length-1&&($(".shapescontainer").one("mouseenter","path",function(e){h(e),$.publish("gallery.firstMouseenter"),$(".shapescontainer").on("mouseenter","path",function(e){h(e)})}),$(e.img).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",t))},50*n)})})},on:function(e,t){$.subscribe(e,t)}},U=!1;!function(e){var t=e({});e.subscribe=function(){t.on.apply(t,arguments)},e.unsubscribe=function(){t.off.apply(t,arguments)},e.publish=function(){t.trigger.apply(t,arguments)}}(jQuery);var V={init:function(e){U||((G=new createjs.LoadQueue(!0)).setMaxConnections(parseInt(e,10)||8),U=!0)},load:function(e,t,n){return new Promise(function(o,i){U||i("Le module de chargement n'a pas été initialisé."),t&&G.removeAll(),G.loadManifest(e),n&&G.on("progress",function(e){$.publish("promiseLoad.progress",e.progress)}),G.on("complete",function(){o(G.getItems())}),G.on("error",function(){i("Erreur de chargement.")})})},on:function(e,t){$.subscribe(e,t)}};window.scale=.5;var ee={content:_.template(["<h1><%= title %></h1>","<div class='text'><%= text %></div>"].join(""))};$(function(){var e=this,t={gallery:null,texts:null},n=null;window.onkeydown=function(e){return!(32==e.keyCode)},$(".textinnercontainer").perfectScrollbar({suppressScrollX:!0,wheelSpeed:3}),V.init(),F.init(),F.rotate.start(30),V.load(["img/studio.png","img/rg.png","img/balloon.png","data/gallery.json"]).then(function(e){t.gallery=e[3].result,$(e[0].result).attr("id","studio").appendTo(".gallerycontainer"),$(e[1].result).attr("id","rg").attr("class","animated bounce infinite").css({left:470*scale+"px",bottom:-60*scale+"px",width:500*scale+"px",height:530*scale+"px"}).appendTo(".gallerycontainer"),Z.init(t.gallery,document.querySelector(".gallerycontainer"),e[2].result.src);var n=V.load(["data/texts.json"].concat(_(t.gallery).map(function(e){return{id:e.id,src:"img/people/"+e.id+".png"}}).value()),!0,!0);return V.on("promiseLoad.progress",function(e,t){$(".info").html(Math.round(100*t)+"%")}),n}).then(function(o){return $(".info").fadeOut(500),$("#rg").removeClass("bounce"),o=_(o).map(function(e){return e.result}).value(),t.texts=o.shift(),t.gallery=_(o).sortBy("item.id").zipWith(t.gallery,function(e,t){return _(t).assign({img:e}).value()}).map(function(e){var n=_(t.texts).find({id:e.text});return n?_(e).assign({code:n.code,textId:n.id}).value():e}).value(),R("/",function(){$(".wrapper").removeClass("show"),$("a.caret-down").removeClass("rubberBand"),$("svg.background").removeClass("uderzo")}),R("/*",function(e){n=e,void 0===_(t.texts).find({code:e})?(n=null,R("/")):("albert-uderzo"===e?($("svg.background").addClass("uderzo"),F.rotate.start(15)):$("svg.background").removeClass("uderzo"),$(".textscroller").html(ee.content(_(t.texts).find({code:e}))),p(200).then(function(){$(".textinnercontainer").scrollTop(0).perfectScrollbar("update")}),$(".wrapper").addClass("show"),$("a.caret-down").hide(),window.setTimeout(function(){$("a.caret-down").show().addClass("rubberBand")},450))}),R.start(!0),$("#title").on("click",function(){R("/")}),$(".shapescontainer").on("click","path",function(e){R($(e.target).data("code"))}),$(document).on("mousewheel",_.debounce(function(e){e.deltaY<0&&""!==window.location.hash&&R("/"),e.deltaY>0&&null!==n&&R(n)}.bind(e),10)),$(window).on("resize",F.resize),J.display(t.gallery)}).then(function(){J.on("gallery.mouseenter",function(e,t){Z.show($(t).data("name"))}),J.on("gallery.mouseleave",Z.hide)}).catch(function(e){console.error(e)}),$("a").on("click",function(){$(".wrapper").hasClass("show")?$(".wrapper").removeClass("show"):$(".wrapper").addClass("show")})}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var r=t||window.event,s=l.call(arguments,1),u=0,d=0,f=0,h=0,p=0,m=0;if(t=e.event.fix(r),t.type="mousewheel","detail"in r&&(f=-1*r.detail),"wheelDelta"in r&&(f=r.wheelDelta),"wheelDeltaY"in r&&(f=r.wheelDeltaY),"wheelDeltaX"in r&&(d=-1*r.wheelDeltaX),"axis"in r&&r.axis===r.HORIZONTAL_AXIS&&(d=-1*f,f=0),u=0===f?d:f,"deltaY"in r&&(f=-1*r.deltaY,u=f),"deltaX"in r&&(d=r.deltaX,0===f&&(u=-1*d)),0!==f||0!==d){if(1===r.deltaMode){var g=e.data(this,"mousewheel-line-height");u*=g,f*=g,d*=g}else if(2===r.deltaMode){var w=e.data(this,"mousewheel-page-height");u*=w,f*=w,d*=w}if(h=Math.max(Math.abs(f),Math.abs(d)),(!a||a>h)&&(a=h,o(r,h)&&(a/=40)),o(r,h)&&(u/=40,d/=40,f/=40),u=Math[u>=1?"floor":"ceil"](u/a),d=Math[d>=1?"floor":"ceil"](d/a),f=Math[f>=1?"floor":"ceil"](f/a),c.settings.normalizeOffset&&this.getBoundingClientRect){var v=this.getBoundingClientRect();p=t.clientX-v.left,m=t.clientY-v.top}return t.deltaX=d,t.deltaY=f,t.deltaFactor=a,t.offsetX=p,t.offsetY=m,t.deltaMode=0,s.unshift(t,u,d,f),i&&clearTimeout(i),i=setTimeout(n,200),(e.event.dispatch||e.event.handle).apply(this,s)}}function n(){a=null}function o(e,t){return c.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var i,a,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(e.event.fixHooks)for(var u=r.length;u;)e.event.fixHooks[r[--u]]=e.event.mouseHooks;var c=e.event.special.mousewheel={version:"3.1.12",setup:function(){var n=this;if(this.addEventListener)for(var o=s.length;o;)n.addEventListener(s[--o],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",c.getLineHeight(this)),e.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){var n=this;if(this.removeEventListener)for(var o=s.length;o;)n.removeEventListener(s[--o],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var n=e(t),o=n["offsetParent"in e.fn?"offsetParent":"parent"]();return o.length||(o=e("body")),parseInt(o.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})}();
